<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Younited – Self Discovery Assessment</title>
<style>
body { font-family: Arial; background:#f7f7f7; margin:0; padding:40px; }
.assessment-wrapper { max-width:700px; margin:auto; background:#fff; padding:40px; }
.question { display:none; }
.question.active { display:block; }
h2 { margin-bottom:10px; }
.description { font-size:14px; color:#555; margin-bottom:20px; }
select { font-size:18px; padding:8px; width:100%; margin:20px 0; }
button { margin-top:30px; padding:12px 20px; font-size:16px; cursor:pointer; }
#lifeReport { max-width:800px; margin:40px auto; font-family:Arial; }
</style>
</head>
<body>

<div class="assessment-wrapper" id="assessmentWrapper"></div>
<div id="lifeReport"></div>

<script>
const categories = [
  { name:"Physical Health", key:"physical", questions:[
    {text:"Energy levels throughout the day", description:"How energized do you feel throughout the day?"},
    {text:"Sleep quality", description:"Are you able to sleep well and wake up refreshed?"},
    {text:"Nutrition habits", description:"How balanced and consistent is your diet?"},
    {text:"Physical activity / movement", description:"How often and effectively do you move your body?"},
    {text:"Overall physical wellbeing", description:"Your overall physical health."}
  ]},
  { name:"Mental Health", key:"mental", questions:[
    {text:"Stress levels", description:"How well do you manage daily stress?"},
    {text:"Focus and mental clarity", description:"How clear is your thinking?"},
    {text:"Decision-making confidence", description:"How confident are you making choices?"},
    {text:"Mental energy / alertness", description:"How alert do you feel?"},
    {text:"Overall mental wellbeing", description:"Your overall mental health."}
  ]},
  { name:"Emotional Health", key:"emotional", questions:[
    {text:"Emotional resilience", description:"How well do you bounce back from setbacks?"},
    {text:"Ability to manage emotions", description:"How well do you handle your emotions?"},
    {text:"Confidence / self-esteem", description:"How positive is your self-image?"},
    {text:"Stress coping ability", description:"How effectively do you cope with stress?"},
    {text:"Overall emotional wellbeing", description:"Your overall emotional health."}
  ]},
  { name:"Relationships", key:"relationships", questions:[
    {text:"Quality of close relationships", description:"How fulfilling are your relationships?"},
    {text:"Communication skills", description:"How well do you communicate?"},
    {text:"Support network strength", description:"Do you have people to rely on?"},
    {text:"Boundaries with others", description:"How healthy are your boundaries?"},
    {text:"Overall relationship wellbeing", description:"Your overall relationships."}
  ]},
  { name:"Career & Purpose", key:"career", questions:[
    {text:"Job satisfaction", description:"How satisfied are you with your work?"},
    {text:"Sense of purpose", description:"Does your work align with your purpose?"},
    {text:"Motivation & engagement", description:"How engaged are you?"},
    {text:"Work–life balance", description:"How balanced is your work and personal life?"},
    {text:"Overall career wellbeing", description:"Your overall career satisfaction."}
  ]},
  { name:"Mindfulness / Spiritual", key:"spiritual", questions:[
    {text:"Presence / mindfulness in daily life", description:"How mindful are you daily?"},
    {text:"Inner calm and peace", description:"How calm and centered do you feel?"},
    {text:"Connection to purpose or meaning", description:"Do you feel aligned with a deeper purpose?"},
    {text:"Self-reflection habits", description:"How often do you reflect on your thoughts?"},
    {text:"Overall spiritual wellbeing", description:"Your overall mindfulness and spiritual balance."}
  ]}
];

const dropdownOptions = [
  { value: 1, label: "1 (Not good)" },
  { value: 2, label: "2 (Below average)" },
  { value: 3, label: "3 (Average)" },
  { value: 4, label: "4 (Good)" },
  { value: 5, label: "5 (Excellent)" }
];

let currentIndex = 0;
const answers = {};

const wrapper = document.getElementById("assessmentWrapper");

const flatQuestions = [];
categories.forEach(cat => {
  cat.questions.forEach(q => flatQuestions.push({category:cat.key, text:q.text, description:q.description}));
});

flatQuestions.forEach((q, index)=>{
  const div = document.createElement("div");
  div.className = "question" + (index===0?" active":"");

  let selectHTML = `<select id="select-${index}">`;
  dropdownOptions.forEach(opt=>selectHTML+=`<option value="${opt.value}">${opt.label}</option>`);
  selectHTML+=`</select>`;

  div.innerHTML = `
    <h2>${q.text}</h2>
    <div class="description">${q.description}</div>
    ${selectHTML}
    <button onclick="next(${index})">${index===flatQuestions.length-1?"Get My Life Report":"Next"}</button>
  `;
  wrapper.appendChild(div);
});

function next(index){
  const select=document.getElementById(`select-${index}`);
  const question=flatQuestions[index];
  if(!answers[question.category]) answers[question.category]={};
  answers[question.category][question.text]=Number(select.value);

  document.querySelectorAll(".question")[index].classList.remove("active");

  currentIndex++;
  if(currentIndex<flatQuestions.length){
    document.querySelectorAll(".question")[currentIndex].classList.add("active");
  } else submitAssessment();
}

function submitAssessment(){
  const endpoint="/.netlify/functions/life-report";

  fetch(endpoint,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({assessment:answers})
  })
  .then(res=>res.json())
  .then(data=>{
    document.getElementById("assessmentWrapper").style.display="none";
    document.getElementById("lifeReport").innerHTML=data.report_html||"<p>No report returned</p>";
  })
  .catch(err=>{
